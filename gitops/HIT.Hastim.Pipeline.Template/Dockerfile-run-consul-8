ARG BASEIMAGE

FROM ${BASEIMAGE} AS copy-src
FROM docker.hasti.co/dotnet/aspnet:8.2
ARG PROJECT
ENV EXE="${PROJECT}.dll"
ENV ASPNETCORE_HTTP_PORTS="80"
ARG CONSULKEYS
ARG CONSULSERVER
ARG CONSULTOKEN
ENV Consul__Keys=$CONSULKEYS
ENV Consul__Server=$CONSULSERVER
ENV Consul__Token=$CONSULTOKEN
WORKDIR /app
EXPOSE 80
COPY --from=copy-src /app/publish .
ENTRYPOINT dotnet "$EXE"